<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LocalCrazyEight.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">l3-poo-war</a> &gt; <a href="index.source.html" class="el_package">game</a> &gt; <span class="el_source">LocalCrazyEight.java</span></div><h1>LocalCrazyEight.java</h1><pre class="source lang-java linenums">package game;

import java.util.LinkedList;
import java.util.Deque;
import java.util.Random;


public class LocalCrazyEight {

<span class="fc" id="L10">    private final String[] PLAYERS_NAMES = {&quot;Naki&quot;, &quot;PL&quot;, &quot;Malik&quot;, &quot;Ken&quot;};</span>
<span class="fc" id="L11">    private final int NB_OF_PLAYERS = PLAYERS_NAMES.length;</span>
<span class="fc" id="L12">    private Player[] initialPlayers = new Player[NB_OF_PLAYERS];</span>
<span class="fc" id="L13">    private final int NUMBER_OF_CARDS_FOR_EACH_PLAYERS = 7;</span>
     
    
<span class="fc" id="L16">    private Deque&lt;Card&gt; allCardsPlayed = new LinkedList&lt;Card&gt;(); </span>
    protected Card lastCardPlayed;
    
    private int turn; 
    private int index; //jack power
    private int nbOfAcePlayed; //ace power
    private int nbOfTurnToPass; //seven power
    private String choosenColor; //eight power
    private boolean replay; //ten power

<span class="fc" id="L26">    protected LocalCrazyEight(){</span>
<span class="fc" id="L27">        allCardsPlayed.add(Deck.getTopCard());</span>
<span class="fc" id="L28">        lastCardPlayed = allCardsPlayed.getLast();</span>

<span class="fc" id="L30">        choosenColor = allCardsPlayed.getLast().getColor();</span>
<span class="fc" id="L31">        index = 1;</span>
<span class="fc" id="L32">        nbOfAcePlayed = 0;</span>
<span class="fc" id="L33">        nbOfTurnToPass = 0;</span>
<span class="fc" id="L34">        replay = false;</span>
<span class="fc" id="L35">    }</span>

    
    protected void playGameWithAllActions(){
<span class="nc" id="L39">        initialisationPlayers();</span>
<span class="nc" id="L40">        System.out.println(Deck.deck.size());</span>
<span class="nc" id="L41">        cardsDistribution();</span>
<span class="nc" id="L42">        System.out.println(Deck.deck.size());</span>
        int realTurn;
        while(true){
            
            
            /*System.out.print(&quot;Visible Card: &quot;);*/
<span class="nc" id="L48">            Card.cardPrinter(lastCardPlayed);</span>
<span class="nc" id="L49">            realTurn = determinationOfRealTurn(turn);</span>
<span class="nc" id="L50">            playerTimeToPlay(realTurn);</span>
            
<span class="nc bnc" id="L52" title="All 2 branches missed.">            if(initialPlayers[realTurn].hasWon()){</span>
<span class="nc" id="L53">                System.out.println(initialPlayers[realTurn].getName()+&quot; KAZANDI&quot;);</span>
<span class="nc" id="L54">                break;</span>
            }
<span class="nc" id="L56">             System.out.println(&quot;Number of cards remains in deck: &quot;+ Deck.deck.size());</span>
<span class="nc" id="L57">            System.out.println(&quot;---------------------&quot;);</span>
        }        
<span class="nc" id="L59">    }</span>

    protected String playGameQuickly(){
<span class="nc" id="L62">        initialisationPlayers();</span>
<span class="nc" id="L63">        cardsDistribution();</span>
        while(true){
<span class="nc bnc" id="L65" title="All 2 branches missed.">            if(this.getPlayerTurn().hasWon()){</span>
<span class="nc" id="L66">                return this.getPlayerTurn().getName() ;</span>
            }
<span class="nc" id="L68">            playerPlayOrPass();            </span>
        }
    }

    protected void playerPlayOrPass(){
<span class="nc" id="L73">        Player playerTurn = this.getPlayerTurn();</span>
        
<span class="nc bnc" id="L75" title="All 2 branches missed.">        if(this.nbOfTurnToPass != 0){ //Si un 7 a été posé le joueur passe son tour</span>
<span class="nc" id="L76">            this.nbOfTurnToPass --;</span>
        }

<span class="nc bnc" id="L79" title="All 2 branches missed.">        else if(isTheCardPowerfull(this.lastCardPlayed)){</span>
        }

        else{
<span class="nc" id="L83">            LinkedList&lt;Card&gt; playableCards = playerTurn.getPlayableCards(this.lastCardPlayed);</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">            if(playableCards.isEmpty()){</span>
<span class="nc" id="L85">                takeCard(1);</span>
            }
            else{
<span class="nc" id="L88">                playSeveralCardsOrOnlyOneCard(playableCards);</span>
            }            
        }        
<span class="nc bnc" id="L91" title="All 2 branches missed.">        if(this.replay){</span>
<span class="nc" id="L92">            this.replay = false;</span>
        }
        else{
<span class="nc" id="L95">            this.nextPlayer();</span>
        }
<span class="nc" id="L97">    }</span>

    protected void playerTimeToPlay(int realTurn){
<span class="nc" id="L100">        Player playerTurn = initialPlayers[realTurn];</span>
<span class="nc" id="L101">        System.out.println(&quot;Next player: &quot; + playerTurn.getName());</span>
<span class="nc" id="L102">        playerTurn.handPrinter();</span>
<span class="nc" id="L103">        playerPlayOrPass();</span>
<span class="nc" id="L104">        System.out.print(&quot;Number of &quot; + playerTurn.getName() + &quot;'s remaining cards: &quot;);</span>
<span class="nc" id="L105">        System.out.println(playerTurn.getHandPlayer().size());</span>
 
<span class="nc" id="L107">    }</span>

    protected boolean isTheCardPowerfull(Card lastCardPlayed){
<span class="nc" id="L110">        Player playerTurn = this.getPlayerTurn();</span>

<span class="nc bnc" id="L112" title="All 4 branches missed.">        if(lastCardPlayed.getValue().equals(&quot;ACE&quot;) &amp;&amp; this.nbOfAcePlayed&gt;0){</span>
<span class="nc" id="L113">            LinkedList&lt;Card&gt; allAceOfThePlayer = new LinkedList&lt;Card&gt;();</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">            for(Card card : playerTurn.getHandPlayer()){</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">                if(card.getValue().equals(&quot;ACE&quot;)){</span>
<span class="nc" id="L116">                    allAceOfThePlayer.add(card);</span>
                }
<span class="nc" id="L118">            }</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">            if(allAceOfThePlayer.isEmpty()){</span>
<span class="nc" id="L120">                takeCard(this.nbOfAcePlayed*2);</span>
<span class="nc" id="L121">                this.nbOfAcePlayed = 0;</span>
            }
            else{
<span class="nc" id="L124">                playSeveralCardsOrOnlyOneCard(allAceOfThePlayer);</span>
            }

<span class="nc" id="L127">            return true;</span>
            
        }

<span class="nc bnc" id="L131" title="All 2 branches missed.">        else if(lastCardPlayed.getValue().equals(&quot;EIGHT&quot;)){</span>
<span class="nc" id="L132">            Card virtualNewEight = new Card(&quot;EIGHT&quot;, this.choosenColor);</span>
<span class="nc" id="L133">            LinkedList&lt;Card&gt; playableCard = playerTurn.getPlayableCards(virtualNewEight);</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">            if(playableCard.isEmpty()){</span>
<span class="nc" id="L135">                takeCard(1);</span>
            }
            else{
<span class="nc" id="L138">                playSeveralCardsOrOnlyOneCard(playableCard);</span>
            }
            
<span class="nc" id="L141">            return true;</span>
        }

<span class="nc" id="L144">        return false;</span>
    }

    protected void getCardPower(Card card){
<span class="pc bpc" id="L148" title="4 of 6 branches missed.">        switch(card.getValue()){</span>
            case &quot;ACE&quot; :
<span class="nc" id="L150">                this.nbOfAcePlayed++; //itération du nombre d'ace en jeu</span>
<span class="nc" id="L151">                break;</span>
        
            case &quot;EIGHT&quot; :
<span class="fc" id="L154">                this.choosenColor = this.getPlayerTurn().determinColorAfterAnEight(); //définit la couleur choisie par le joueur</span>
<span class="fc" id="L155">                break;</span>

            case &quot;TEN&quot; :
<span class="nc" id="L158">                this.replay = true;</span>
<span class="nc" id="L159">                break;</span>

            case &quot;JACK&quot; :
<span class="nc" id="L162">                this.reverse();</span>
<span class="nc" id="L163">                break;</span>

            case &quot;SEVEN&quot; :
<span class="nc" id="L166">                this.nbOfTurnToPass +=1;</span>
<span class="nc" id="L167">                break;</span>

            default :
                break;
        }
<span class="fc" id="L172">    }</span>

    public void takeCard(int nbOfCardsPlayerMustToTake){
<span class="fc" id="L175">        Player playerTurn = this.getPlayerTurn();</span>
        Card card;

<span class="fc bfc" id="L178" title="All 2 branches covered.">        for(int i=0; i &lt; nbOfCardsPlayerMustToTake; i++){</span>
<span class="pc bpc" id="L179" title="1 of 2 branches missed.">            if((card = Deck.getTopCard()) == null){</span>
<span class="nc" id="L180">                deckReshuffler();</span>
            }
            else{
<span class="fc" id="L183">                playerTurn.getHandPlayer().add(card);</span>
            }
        }
<span class="fc" id="L186">    } </span>
    
    protected void playSeveralCardsOrOnlyOneCard(LinkedList&lt;Card&gt; playableCards){
<span class="fc" id="L189">        Player playerTurn = this.getPlayerTurn();</span>

<span class="fc" id="L191">        int size = playableCards.size();</span>
<span class="fc" id="L192">        Card cardPlayed = playableCards.get(0);</span>
<span class="fc" id="L193">        int combination = playerTurn.nbOfCombinationOfTheCard(cardPlayed);</span>
<span class="fc bfc" id="L194" title="All 2 branches covered.">        if(size &gt; 1){</span>
<span class="fc" id="L195">            cardPlayed = playerTurn.makeTheBestChoice(playableCards, this.lastCardPlayed);</span>
        }
        else{
<span class="pc bpc" id="L198" title="1 of 2 branches missed.">            if(combination == 1){</span>
<span class="fc" id="L199">                oneCardIsPlayed(cardPlayed);</span>
<span class="fc" id="L200">                return ;</span>
            }
        }            
<span class="pc bpc" id="L203" title="2 of 4 branches missed.">            if((combination == 1) || cardPlayed.getValue().equals(&quot;EIGHT&quot;)){</span>
<span class="nc" id="L204">                oneCardIsPlayed(cardPlayed);</span>
            }
<span class="fc bfc" id="L206" title="All 2 branches covered.">            else if(combination == 2){                </span>
<span class="fc" id="L207">                playTwoCards(playerTurn, cardPlayed, playableCards);</span>
            }
            else{                
<span class="fc" id="L210">                playThreeOrFourCards(playerTurn, cardPlayed, combination);</span>
            }
            
<span class="fc" id="L213">        }</span>
        
        protected void playTwoCards(Player playerTurn, Card cardPlayed, LinkedList&lt;Card&gt; playableCards){
<span class="fc" id="L216">            oneCardIsPlayed(cardPlayed);</span>
<span class="fc" id="L217">            Card theSecondCardToPlay = playableCards.get(0);</span>
<span class="pc bpc" id="L218" title="1 of 2 branches missed.">                for(Card card : playerTurn.getHandPlayer()){</span>
<span class="pc bpc" id="L219" title="2 of 4 branches missed.">                    if(card.haveSameValue(cardPlayed) &amp;&amp; !(card.haveSameColor(cardPlayed))){</span>
<span class="fc" id="L220">                        theSecondCardToPlay = card;</span>
<span class="fc" id="L221">                        break;</span>
                    }
<span class="nc" id="L223">                }                </span>
<span class="fc" id="L224">                oneCardIsPlayed(theSecondCardToPlay);</span>
<span class="fc" id="L225">        }</span>

        protected void playThreeOrFourCards(Player playerTurn, Card cardPlayed, int combination){
<span class="fc" id="L228">            Card finalCardToPlay = playerTurn.cardPlayedAtTheEndOfTheCombination(cardPlayed, combination);</span>
<span class="fc" id="L229">                LinkedList&lt;Card&gt; otherCardsPlayed = new LinkedList&lt;&gt;();            </span>
<span class="fc bfc" id="L230" title="All 2 branches covered.">                for(Card card : playerTurn.getHandPlayer()){</span>
<span class="fc bfc" id="L231" title="All 4 branches covered.">                    if(card.haveSameValue(finalCardToPlay) &amp;&amp; !(card.haveSameColor(finalCardToPlay))){</span>
<span class="fc" id="L232">                        otherCardsPlayed.add(card); //secondCard = card</span>
<span class="fc bfc" id="L233" title="All 2 branches covered.">                        if(combination==3){</span>
<span class="fc" id="L234">                            break;</span>
                        }
                    }
<span class="fc" id="L237">                }</span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">                for(Card card : otherCardsPlayed){</span>
<span class="fc" id="L239">                    oneCardIsPlayed(card);</span>
<span class="fc" id="L240">                }</span>
<span class="fc" id="L241">                oneCardIsPlayed(finalCardToPlay);</span>
<span class="fc" id="L242">        }</span>

        protected void oneCardIsPlayed(Card cardPlayed){
<span class="fc" id="L245">            Player playerTurn = this.getPlayerTurn();</span>
<span class="fc" id="L246">        this.allCardsPlayed.add(cardPlayed);        </span>
<span class="fc" id="L247">        System.out.println(cardPlayed.getValue() + &quot; OF &quot; + cardPlayed.getColor());</span>
<span class="fc" id="L248">        playerTurn.getHandPlayer().remove(cardPlayed);</span>
<span class="fc" id="L249">        getCardPower(cardPlayed);</span>
<span class="fc" id="L250">        this.lastCardPlayed = this.allCardsPlayed.getLast();</span>
<span class="fc" id="L251">    }</span>
    
    private int determinationOfRealTurn(int turn){
<span class="pc bpc" id="L254" title="1 of 2 branches missed.">        if(turn % NB_OF_PLAYERS &gt;= 0){</span>
<span class="fc" id="L255">            return turn % NB_OF_PLAYERS;</span>
        }
        else{
<span class="nc" id="L258">            return turn % NB_OF_PLAYERS + NB_OF_PLAYERS;</span>
        }

    }
    
    protected void cardsDistribution(){
<span class="fc bfc" id="L264" title="All 2 branches covered.">        for(Player p : initialPlayers){</span>
<span class="fc bfc" id="L265" title="All 2 branches covered.">            for(int i=0; i&lt;NUMBER_OF_CARDS_FOR_EACH_PLAYERS; i++){</span>
<span class="fc" id="L266">                p.getHandPlayer().add(Deck.getTopCard());</span>
            }
        }
<span class="fc" id="L269">    }</span>
    public static void main(String[] args){
<span class="nc" id="L271">        LocalCrazyEight game = new LocalCrazyEight();</span>
<span class="nc" id="L272">        game.playGameWithAllActions();</span>


<span class="nc" id="L275">    }</span>
    
    protected void initialisationPlayers(){
<span class="fc bfc" id="L278" title="All 2 branches covered.">        for(int i=0; i&lt;NB_OF_PLAYERS; i++){</span>
<span class="fc" id="L279">            Player p = new Player(PLAYERS_NAMES[i]);</span>
<span class="fc" id="L280">            initialPlayers[i] = p;</span>
        }
<span class="fc" id="L282">    }</span>

    protected void deckReshuffler(){
<span class="fc" id="L285">        Random random = new Random();</span>
<span class="fc" id="L286">        LinkedList&lt;Card&gt; cards = (LinkedList&lt;Card&gt;)allCardsPlayed;</span>
<span class="fc bfc" id="L287" title="All 2 branches covered.">        while(!cards.isEmpty()){</span>
<span class="fc" id="L288">            int randomNumber = random.nextInt(cards.size());</span>
<span class="fc" id="L289">            Deck.deck.add(cards.get(randomNumber));</span>
<span class="fc" id="L290">            cards.remove(randomNumber);</span>
<span class="fc" id="L291">        } </span>
<span class="fc" id="L292">    }</span>

    protected Player getPlayerTurn(){
<span class="fc" id="L295">        return this.initialPlayers[determinationOfRealTurn(turn)];</span>
    }

    protected void reverse(){
<span class="nc" id="L299">        index = index * (-1);</span>
<span class="nc" id="L300">    }</span>

    protected void nextPlayer(){
<span class="nc" id="L303">        turn += getIndex();</span>
<span class="nc" id="L304">    }</span>

    protected Deque&lt;Card&gt; getAllCardsPlayed(){
<span class="fc" id="L307">        return allCardsPlayed;</span>
    }

    protected Player[] getInitialPlayers(){
<span class="fc" id="L311">        return initialPlayers;</span>
    }

    protected String[] getPlayersNames(){
<span class="nc" id="L315">        return PLAYERS_NAMES;</span>
    }

    protected int getIndex(){
<span class="nc" id="L319">        return index;</span>
    }

    protected int getTurn(){
<span class="nc" id="L323">        return turn;</span>
    }

    protected String getChoosenColor(){
<span class="fc" id="L327">        return this.choosenColor;</span>
    }

    protected int getNbOfPlayers(){
<span class="fc" id="L331">        return NB_OF_PLAYERS;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>